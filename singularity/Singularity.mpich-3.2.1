Bootstrap: shub
From: Dill-PICL/GOMAP-base:latest

%labels
GOMAP_OWNER Wimalanathan Kokulapalan
GOMAP_MAINTAINER Wimalanathan Kokulapalan 
GOMAP_VERSION v1.3.4

%files
	GOMAP /opt/

%environment
    export LC_ALL=C 
    export DEBIAN_FRONTEND=noninteractive
 
%post
	export DEBIAN_FRONTEND="noninteractive"
	echo "Running post      "

    # Downloading GOMAP code
	ls -la /opt
	chmod -R 777 /opt/GOMAP/
	
    #Downloading backed in GOMAP code 
	cd /opt/GOMAP/data && \
	chmod -R 755 software && chmod -R 755 data

    #Installing mpich and python package to use it
	wget -q http://www.mpich.org/static/downloads/3.2.1/mpich-3.2.1.tar.gz  && \
	tar -xf  mpich-3.2.1.tar.gz && \
	cd mpich-3.2.1 &&  \
	./configure && make -j8 && make install &&  \
	cd .. && \
	pip install mpi4py==3.0.0  
	
    #Making necessary directories
	  mkdir -p /workdir
	  mkdir -p /tmpdir
	  mkdir -p /work	  
	  mkdir -p /scratch

	  
	  echo "Completed Post   "

%startscript
	chmod 777 /tmp

%runscript
	cd /opt/GOMAP/ 
	./gomap.py "$@"
