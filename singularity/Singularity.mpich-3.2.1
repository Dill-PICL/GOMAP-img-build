Bootstrap: shub
From: Dill-PICL/GOMAP-base:latest

%labels
MAINTAINER Kokulapalan Wimalanathan
Version 1.3.2 
HPC ISU-condo


%environment
    export LC_ALL=C 
    export DEBIAN_FRONTEND=noninteractive
 
%post
	echo "Running post"

    # Downloading GOMAP code
		mkdir /opt/GOMAP/ && \
		git clone --branch=dev https://github.com/Dill-PICL/GOMAP.git /opt/GOMAP/ && \
		chmod -R 777 /opt/GOMAP/
	
    #Downloading backed in GOMAP code 
		cd /opt/GOMAP/data && \
		iget -P /iplant/home/shared/dillpicl/gomap/GOMAP-data.v1.3/data.tar.gz && ls && tar -xvf data.tar.gz && rm data.tar.gz && \
		iget -P /iplant/home/shared/dillpicl/gomap/GOMAP-data.v1.3/software.tar.gz && tar -xvf software.tar.gz && rm software.tar.gz && \
		chmod -R 755 software && chmod -R 755 data

    #Installing mpich and python package to use it
		wget http://www.mpich.org/static/downloads/3.2.1/mpich-3.2.1.tar.gz  && \
		tar -xf  mpich-3.2.1.tar.gz && \
		cd mpich-3.2.1 &&  \
		./configure && make -j8 && make install &&  \
		cd .. && \
		pip install mpi4py==3.0.0  
	
    #Making necessary directories
	  mkdir -p /workdir
	  mkdir -p /tmpdir
	  mkdir -p /work
	  
	  mkdir -p /scratch

	  
	  echo "Completed Post"

%startscript
	chmod 777 /tmp

%runscript
	cd /opt/GOMAP/ 
	./gomap.py "$@"
